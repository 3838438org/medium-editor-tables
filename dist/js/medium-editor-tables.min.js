!function(a,b){"use strict";"object"==typeof module?module.exports=b:"function"==typeof define&&define.amd?define(b):a.MediumEditorTable=b}(this,function(){"use strict";function a(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:""}function b(a){var b=a.getSelection().anchorNode,c=b&&3===b.nodeType?b.parentNode:b;return c}function c(a,b){if(void 0!==window.getSelection&&a){var c=document.createRange(),d=window.getSelection();b?c.setStartBefore(a):c.setStartAfter(a),c.collapse(!0),d.removeAllRanges(),d.addRange(c)}}function d(a){if(!a)return!1;for(var b=a.parentNode,c=b.tagName.toLowerCase();"body"!==c;){if("table"===c)return!0;if(b=b.parentNode,!b||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1}function e(a,b){var c=a&&a.tagName?a.tagName.toLowerCase():!1;if(!c)return!1;for(;c&&"body"!==c;){if(c===b)return a;a=a.parentNode,c=a&&a.tagName?a.tagName.toLowerCase():!1}}function f(a,b,c){return--b.cells.length==a.cellIndex&&--c.rows.length==b.rowIndex}function g(a){return a=a.previousSibling,a?a.cells[a.cells.length-1]:void 0}function h(a,b){return this.init(a,b)}function i(a){return this.init(a)}function j(a){return this.init(a)}function k(){this.parent=!0,this.hasForm=!0,this.isFormVisible=!1,this.createButton()}return h.prototype={init:function(a,b){return this._root=a,this._callback=b,this._render()},setCurrentCell:function(a){this._currentCell=a},markCells:function(){[].forEach.call(this._cellsElements,function(a){var b={col:parseInt(a.dataset.col,10),row:parseInt(a.dataset.row,10)},c=this._currentCell&&b.row<=this._currentCell.row&&b.col<=this._currentCell.col;c===!0?a.classList.add("active"):a.classList.remove("active")}.bind(this))},_generateCells:function(){this._cells=[];for(var a=0;100>a;a++){var b=a%10,c=Math.floor(a/10);this._cells.push({col:b,row:c,active:!1})}},_html:function(){var a='<div class="medium-editor-table-builder-grid clearfix">';return a+=this._cellsHTML(),a+="</div>"},_cellsHTML:function(){var a="";return this._generateCells(),this._cells.map(function(b){a+='<a href="#" class="medium-editor-table-builder-cell'+(b.active===!0?" active":"")+'" data-row="'+b.row+'" data-col="'+b.col+'">',a+="</a>"}),a},_render:function(){this._root.innerHTML=this._html(),this._cellsElements=this._root.querySelectorAll("a"),this._bindEvents()},_bindEvents:function(){[].forEach.call(this._cellsElements,function(a){this._onMouseEnter(a),this._onClick(a)}.bind(this))},_onMouseEnter:function(a){var b,c=this;a.addEventListener("mouseenter",function(){clearTimeout(b);var a=this.dataset;b=setTimeout(function(){c._currentCell={col:parseInt(a.col,10),row:parseInt(a.row,10)},c.markCells()},10)})},_onClick:function(a){var b=this;a.addEventListener("click",function(a){a.preventDefault(),b._callback(this.dataset.col,this.dataset.row)})}},i.prototype={init:function(a){this.options=a,this._doc=a.ownerDocument||document,this._root=this._doc.createElement("div"),this._root.className="medium-editor-table-builder",this.grid=new h(this._root,this.options.onClick)},getElement:function(){return this._root},hide:function(){this._root.style.display="",this.grid.setCurrentCell({col:-1,row:-1}),this.grid.markCells()},show:function(a){this._root.style.display="block",this._root.style.left=a+"px"}},j.prototype={init:function(a){this._editor=a,this._bindTabBehavior()},insert:function(b,d){var e,f,g="",h=a();for(f=0;d>=f;f++){for(g+="<tr>",e=0;b>=e;e++)g+=0===f&&0===e?"<td>"+h+"</td>":"<td><br /></td>";g+="</tr>"}this._editor.insertHTML('<table class="medium-editor-table" id="medium-editor-table"><tbody>'+g+"</tbody></table>");var i=this._editor.options.ownerDocument.getElementById("medium-editor-table");i.removeAttribute("id"),c(i.querySelector("td"),!0)},_bindTabBehavior:function(){var a=this;[].forEach.call(this._editor.elements,function(h){h.addEventListener("keydown",function(h){var i=b(a._editor.options.ownerDocument),j=j,k=k;9===h.which&&d(i)&&(h.preventDefault(),h.stopPropagation(),i=e(i,"td"),j=e(i,"tr"),k=e(i,"table"),h.shiftKey?c(i.previousSibling||g(j),!0):(f(i,j,k)&&a._insertRow(e(i,"tbody"),j.cells.length),c(i)))})})},_insertRow:function(a,b){var c,d=document.createElement("tr"),e="";for(c=0;b>c;c+=1)e+="<td><br /></td>";d.innerHTML=e,a.appendChild(d)}},k.prototype={createButton:function(){this._createButtonElement(),this._bindButtonClick()},getForm:function(){return this.builder||(this.builder=new i({onClick:function(a,b){this.table.insert(a,b)}.bind(this),ownerDocument:this.base.options.ownerDocument}),this.table=new j(this.base)),this.builder.getElement()},getButton:function(){return"fontawesome"===this.base.options.buttonLabels&&(this.button.innerHTML='<i class="fa fa-table"></i>'),this.button},onHide:function(){this.hide()},hide:function(){this.isFormVisible=!1,this.builder.hide(),this.button.classList.remove("medium-editor-button-active")},show:function(){this.isFormVisible=!0,this.builder.show(this.button.offsetLeft),this.button.classList.add("medium-editor-button-active")},_createButtonElement:function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML="tbl"},_bindButtonClick:function(){this.button.addEventListener("click",function(a){a.preventDefault(),this[this.isFormVisible===!0?"hide":"show"]()}.bind(this))}},k}());