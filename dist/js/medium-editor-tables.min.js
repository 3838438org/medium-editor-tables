"use strict";function getSelectionStart(){var a=self.base.options.ownerDocument.getSelection().anchorNode,b=a&&3===a.nodeType?a.parentNode:a;return b}function placeCaretAtNode(a,b){if(void 0!==window.getSelection&&a){var c=document.createRange(),d=window.getSelection();b?c.setStartBefore(a):c.setStartAfter(a),c.collapse(!0),d.removeAllRanges(),d.addRange(c)}}function isInsideTable(a){if(!a)return!1;for(var b=a.parentNode,c=b.tagName.toLowerCase();"body"!==c;){if("table"===c)return!0;if(b=b.parentNode,!b||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1}function getParentOf(a,b){var c=a&&a.tagName?a.tagName.toLowerCase():!1;if(!c)return!1;for(;c&&"body"!==c;){if(c===b)return a;a=a.parentNode,c=a&&a.tagName?a.tagName.toLowerCase():!1}}function isLastCell(a,b,c){return--b.cells.length==a.cellIndex&&--c.rows.length==b.rowIndex}function getPreviousRowLastCell(a){return a=a.previousSibling,a?a.cells[a.cells.length-1]:void 0}function MediumEditorTable(){this.parent=!0,this.hasForm=!0,this.showGrid=!1,this.createButton()}MediumEditorTable.prototype.createButton=function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML='<i class="table"></i>',this.button.addEventListener("click",function(a){a.preventDefault(),this.clickHandler()}.bind(this))},MediumEditorTable.prototype.clickHandler=function(){this.showGrid===!0?this.hide():this.show()},MediumEditorTable.prototype.hide=function(){this.showGrid=!1,this.tableBuilderElement.style.display="",this.button.classList.remove("medium-editor-button-active")},MediumEditorTable.prototype.show=function(){this.showGrid=!0,this.tableBuilderElement.style.display="block",this.tableBuilderElement.style.left=this.button.offsetLeft+"px",this.button.classList.add("medium-editor-button-active")},MediumEditorTable.prototype.getForm=function(){return this.tableBuilderElement||this.createTableBuilder(),this.tableBuilderElement},MediumEditorTable.prototype.createTableBuilder=function(){this.tableBuilderElement=this.base.options.ownerDocument.createElement("div"),this.tableBuilderElement.className="medium-editor-table-builder",this.renderGrid(),this.bind()},MediumEditorTable.prototype.generateCells=function(){this.cells=[];for(var a=0;100>a;a++){var b=a%10,c=Math.floor(a/10);this.cells.push({col:b,row:c,active:!1})}},MediumEditorTable.prototype.getGridHTML=function(){var a='<div class="medium-editor-table-builder-grid clearfix">';return a+=this.getCellsHTML(),a+="</div>"},MediumEditorTable.prototype.getCellsHTML=function(){var a="";return this.generateCells(),this.cells.map(function(b){a+='<a href="#" class="medium-editor-table-builder-cell'+(b.active===!0?" active":"")+'" data-row="'+b.row+'" data-col="'+b.col+'">',a+="</a>"}),a},MediumEditorTable.prototype.renderGrid=function(){this.tableBuilderElement.innerHTML=this.getGridHTML(),this.cellsElements=this.tableBuilderElement.querySelectorAll("a")},MediumEditorTable.prototype.onHide=function(){this.hide(),this.hoveredCell={col:-1,row:-1},this.markCells()},MediumEditorTable.prototype.getButton=function(){return this.button},MediumEditorTable.prototype.bind=function(){[].forEach.call(this.cellsElements,function(a){this.bindMouseEnter(a),this.bindClick(a)}.bind(this)),this.bindTabOnTables()},MediumEditorTable.prototype.bindMouseEnter=function(a){var b,c=this;a.addEventListener("mouseenter",function(){clearTimeout(b);var a=this.dataset;b=setTimeout(function(){c.hoveredCell={col:parseInt(a.col,10),row:parseInt(a.row,10)},c.markCells()},10)})},MediumEditorTable.prototype.bindClick=function(a){var b=this;a.addEventListener("click",function(a){a.preventDefault(),b.insertTable(this.dataset.col,this.dataset.row)})},MediumEditorTable.prototype.markCells=function(){var a=this;[].forEach.call(this.cellsElements,function(b){var c={col:parseInt(b.dataset.col,10),row:parseInt(b.dataset.row,10)},d=a.hoveredCell&&c.col<=a.hoveredCell.col&&c.row<=a.hoveredCell.row;d===!0?b.classList.add("active"):b.classList.remove("active")})},MediumEditorTable.prototype.insertTable=function(a,b){var c,d,e="";for(d=0;b>=d;d++){for(e+="<tr>",c=0;a>=c;c++)e+="<td><br /></td>";e+="</tr>"}this.base.insertHTML('<table className="medium-editor-table" id="medium-editor-table"><tbody>'+e+"</tbody></table><p><br /></p>");var f=this.base.options.ownerDocument.getElementById("medium-editor-table");f.removeAttribute("id"),placeCaretAtNode(f.querySelector("td"),!0)},MediumEditorTable.prototype.bindTabOnTables=function(){var a=this;[].forEach.call(this.base.elements,function(b){b.addEventListener("keydown",function(b){var c=getSelectionStart(),d=d,e=e;9===b.which&&isInsideTable(c)&&(b.preventDefault(),b.stopPropagation(),c=getParentOf(c,"td"),d=getParentOf(c,"tr"),e=getParentOf(c,"table"),b.shiftKey?placeCaretAtNode(c.previousSibling||getPreviousRowLastCell(d),!0):(isLastCell(c,d,e)&&a.insertRow(getParentOf(c,"tbody"),d.cells.length),placeCaretAtNode(c)))})})},MediumEditorTable.prototype.insertRow=function(a,b){var c,d=document.createElement("tr"),e="";for(c=0;b>c;c+=1)e+="<td><br /></td>";d.innerHTML=e,a.appendChild(d)},module.exports=MediumEditorTable;