!function(a,b){"use strict";"object"==typeof module?module.exports=b:"function"==typeof define&&define.amd?define(b):a.MediumEditorTable=b}(this,function(){"use strict";function a(a){var b=a.getSelection().anchorNode,c=b&&3===b.nodeType?b.parentNode:b;return c}function b(a,b){if(void 0!==window.getSelection&&a){var c=document.createRange(),d=window.getSelection();b?c.setStartBefore(a):c.setStartAfter(a),c.collapse(!0),d.removeAllRanges(),d.addRange(c)}}function c(a){if(!a)return!1;for(var b=a.parentNode,c=b.tagName.toLowerCase();"body"!==c;){if("table"===c)return!0;if(b=b.parentNode,!b||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1}function d(a,b){var c=a&&a.tagName?a.tagName.toLowerCase():!1;if(!c)return!1;for(;c&&"body"!==c;){if(c===b)return a;a=a.parentNode,c=a&&a.tagName?a.tagName.toLowerCase():!1}}function e(a,b,c){return--b.cells.length==a.cellIndex&&--c.rows.length==b.rowIndex}function f(a){return a=a.previousSibling,a?a.cells[a.cells.length-1]:void 0}function g(a){return this.init(a)}function h(){this.parent=!0,this.hasForm=!0,this.showGrid=!1,this.createButton()}return g.prototype={init:function(a){this.options=a,this._doc=a.ownerDocument||document,this._root=this._doc.createElement("div"),this._root.className="medium-editor-table-builder",this._renderGrid(),this._bindEvents()},getElement:function(){return this._root},hide:function(){this._root.style.display="",this.setCurrentCell({col:-1,row:-1}),this._markCells()},show:function(a){this._root.style.display="block",this._root.style.left=a+"px"},setCurrentCell:function(a){this._currentCell=a},_markCells:function(){[].forEach.call(this._cellsElements,function(a){var b={col:parseInt(a.dataset.col,10),row:parseInt(a.dataset.row,10)},c=this._currentCell&&b.row<=this._currentCell.row&&b.col<=this._currentCell.col;c===!0?a.classList.add("active"):a.classList.remove("active")}.bind(this))},_generateCells:function(){this._cells=[];for(var a=0;100>a;a++){var b=a%10,c=Math.floor(a/10);this._cells.push({col:b,row:c,active:!1})}},_getGridHTML:function(){var a='<div class="medium-editor-table-builder-grid clearfix">';return a+=this._getCellsHTML(),a+="</div>"},_getCellsHTML:function(){var a="";return this._generateCells(),this._cells.map(function(b){a+='<a href="#" class="medium-editor-table-builder-cell'+(b.active===!0?" active":"")+'" data-row="'+b.row+'" data-col="'+b.col+'">',a+="</a>"}),a},_renderGrid:function(){this._root.innerHTML=this._getGridHTML(),this._cellsElements=this._root.querySelectorAll("a")},_bindEvents:function(){[].forEach.call(this._cellsElements,function(a){this._onMouseEnter(a),this._onClick(a)}.bind(this))},_onMouseEnter:function(a){var b,c=this;a.addEventListener("mouseenter",function(){clearTimeout(b);var a=this.dataset;b=setTimeout(function(){c._currentCell={col:parseInt(a.col,10),row:parseInt(a.row,10)},c._markCells()},10)})},_onClick:function(a){var b=this;a.addEventListener("click",function(a){a.preventDefault(),b.options.onClick(this.dataset.col,this.dataset.row)})}},h.prototype={createButton:function(){this._createButtonElement(),this._bindButtonClick()},getForm:function(){return this.builder||(this.builder=new g({onClick:function(a,b){this._insertTable(a,b)}.bind(this),ownerDocument:this.base.options.ownerDocument}),this._bindTabBehavior()),this.builder.getElement()},getButton:function(){return"fontawesome"===this.base.options.buttonLabels&&(this.button.innerHTML='<i class="fa fa-table"></i>'),this.button},onHide:function(){this.hide()},hide:function(){this.showGrid=!1,this.builder.hide(),this.button.classList.remove("medium-editor-button-active")},show:function(){this.showGrid=!0,this.builder.show(this.button.offsetLeft),this.button.classList.add("medium-editor-button-active")},_createButtonElement:function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML="tbl"},_bindButtonClick:function(){this.button.addEventListener("click",function(a){a.preventDefault(),this[this.showGrid===!0?"hide":"show"]()}.bind(this))},_insertTable:function(a,c){var d,e,f="",g=window.getSelection().toString();for(e=0;c>=e;e++){for(f+="<tr>",d=0;a>=d;d++)f+=0===e&&0===d?"<td>"+g+"</td>":"<td><br /></td>";f+="</tr>"}this.base.insertHTML('<table class="medium-editor-table" id="medium-editor-table"><tbody>'+f+"</tbody></table>");var h=this.base.options.ownerDocument.getElementById("medium-editor-table");h.removeAttribute("id"),b(h.querySelector("td"),!0)},_bindTabBehavior:function(){var g=this;[].forEach.call(this.base.elements,function(h){h.addEventListener("keydown",function(h){var i=a(g.base.options.ownerDocument),j=j,k=k;9===h.which&&c(i)&&(h.preventDefault(),h.stopPropagation(),i=d(i,"td"),j=d(i,"tr"),k=d(i,"table"),h.shiftKey?b(i.previousSibling||f(j),!0):(e(i,j,k)&&g._insertRow(d(i,"tbody"),j.cells.length),b(i)))})})},_insertRow:function(a,b){var c,d=document.createElement("tr"),e="";for(c=0;b>c;c+=1)e+="<td><br /></td>";d.innerHTML=e,a.appendChild(d)}},h}());