!function(a,b){"use strict";"object"==typeof module?module.exports=b:"function"==typeof define&&define.amd?define(b):a.MediumEditorTable=b}(this,function(){"use strict";function a(){this.parent=!0,this.hasForm=!0,this.showGrid=!1,this.createButton()}function b(a){var b=a.getSelection().anchorNode,c=b&&3===b.nodeType?b.parentNode:b;return c}function c(a,b){if(void 0!==window.getSelection&&a){var c=document.createRange(),d=window.getSelection();b?c.setStartBefore(a):c.setStartAfter(a),c.collapse(!0),d.removeAllRanges(),d.addRange(c)}}function d(a){if(!a)return!1;for(var b=a.parentNode,c=b.tagName.toLowerCase();"body"!==c;){if("table"===c)return!0;if(b=b.parentNode,!b||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1}function e(a,b){var c=a&&a.tagName?a.tagName.toLowerCase():!1;if(!c)return!1;for(;c&&"body"!==c;){if(c===b)return a;a=a.parentNode,c=a&&a.tagName?a.tagName.toLowerCase():!1}}function f(a,b,c){return--b.cells.length==a.cellIndex&&--c.rows.length==b.rowIndex}function g(a){return a=a.previousSibling,a?a.cells[a.cells.length-1]:void 0}return a.prototype={createButton:function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML="tbl",this.button.addEventListener("click",function(a){a.preventDefault(),this.clickHandler()}.bind(this))},clickHandler:function(){this.showGrid===!0?this.hide():this.show()},hide:function(){this.showGrid=!1,this.tableBuilderElement.style.display="",this.button.classList.remove("medium-editor-button-active")},show:function(){this.showGrid=!0,this.tableBuilderElement.style.display="block",this.tableBuilderElement.style.left=this.button.offsetLeft+"px",this.button.classList.add("medium-editor-button-active")},getForm:function(){return this.tableBuilderElement||this.createTableBuilder(),this.tableBuilderElement},createTableBuilder:function(){this.tableBuilderElement=this.base.options.ownerDocument.createElement("div"),this.tableBuilderElement.className="medium-editor-table-builder",this.renderGrid(),this.bind()},generateCells:function(){this.cells=[];for(var a=0;100>a;a++){var b=a%10,c=Math.floor(a/10);this.cells.push({col:b,row:c,active:!1})}},getGridHTML:function(){var a='<div class="medium-editor-table-builder-grid clearfix">';return a+=this.getCellsHTML(),a+="</div>"},getCellsHTML:function(){var a="";return this.generateCells(),this.cells.map(function(b){a+='<a href="#" class="medium-editor-table-builder-cell'+(b.active===!0?" active":"")+'" data-row="'+b.row+'" data-col="'+b.col+'">',a+="</a>"}),a},renderGrid:function(){this.tableBuilderElement.innerHTML=this.getGridHTML(),this.cellsElements=this.tableBuilderElement.querySelectorAll("a")},onHide:function(){this.hide(),this.hoveredCell={col:-1,row:-1},this.markCells()},getButton:function(){return"fontawesome"===this.base.options.buttonLabels&&(this.button.innerHTML='<i class="fa fa-table"></i>'),this.button},bind:function(){[].forEach.call(this.cellsElements,function(a){this.bindMouseEnter(a),this.bindClick(a)}.bind(this)),this.bindTabOnTables()},bindMouseEnter:function(a){var b,c=this;a.addEventListener("mouseenter",function(){clearTimeout(b);var a=this.dataset;b=setTimeout(function(){c.hoveredCell={col:parseInt(a.col,10),row:parseInt(a.row,10)},c.markCells()},10)})},bindClick:function(a){var b=this;a.addEventListener("click",function(a){a.preventDefault(),b.insertTable(this.dataset.col,this.dataset.row)})},markCells:function(){var a=this;[].forEach.call(this.cellsElements,function(b){var c={col:parseInt(b.dataset.col,10),row:parseInt(b.dataset.row,10)},d=a.hoveredCell&&c.row<=a.hoveredCell.row&&c.col<=a.hoveredCell.col;d===!0?b.classList.add("active"):b.classList.remove("active")})},insertTable:function(a,b){var d,e,f="";for(e=0;b>=e;e++){for(f+="<tr>",d=0;a>=d;d++)f+="<td><br /></td>";f+="</tr>"}this.base.insertHTML('<table class="medium-editor-table" id="medium-editor-table"><tbody>'+f+"</tbody></table><p><br /></p>");var g=this.base.options.ownerDocument.getElementById("medium-editor-table");g.removeAttribute("id"),c(g.querySelector("td"),!0)},bindTabOnTables:function(){var a=this;[].forEach.call(this.base.elements,function(h){h.addEventListener("keydown",function(h){var i=b(a.base.options.ownerDocument),j=j,k=k;9===h.which&&d(i)&&(h.preventDefault(),h.stopPropagation(),i=e(i,"td"),j=e(i,"tr"),k=e(i,"table"),h.shiftKey?c(i.previousSibling||g(j),!0):(f(i,j,k)&&a.insertRow(e(i,"tbody"),j.cells.length),c(i)))})})},insertRow:function(a,b){var c,d=document.createElement("tr"),e="";for(c=0;b>c;c+=1)e+="<td><br /></td>";d.innerHTML=e,a.appendChild(d)}},a}());